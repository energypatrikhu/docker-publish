#!/usr/bin/env bun
// @bun
var u=Object.create;var{getPrototypeOf:r,defineProperty:J,getOwnPropertyNames:n}=Object;var i=Object.prototype.hasOwnProperty;var s=(z,B,L)=>{L=z!=null?u(r(z)):{};let W=B||!z||!z.__esModule?J(L,"default",{value:z,enumerable:!0}):L;for(let X of n(z))if(!i.call(W,X))J(W,X,{get:()=>z[X],enumerable:!0});return W};var Z=(z,B)=>()=>(B||z((B={exports:{}}).exports,B),B.exports);var S=import.meta.require;var N=Z((D)=>{Object.defineProperty(D,"__esModule",{value:!0});D.default=void 0;var a=t(S("readline"));function t(z){return z&&z.__esModule?z:{default:z}}class R{constructor(z=process.stdin){this.stream=z,this.values=[],this.selectedValue=0,this.onSelectListener=()=>{},this.onKeyPress=this.onKeyPress.bind(this)}setValues(z){if(this.values=z,this.renderer)this.renderer.setValues(z)}setDefaultValue(z){this.selectedValue=z}attachRenderer(z){this.renderer=z,this.renderer.setValues(this.values)}onSelect(z){this.onSelectListener=z}open(){if(a.default.emitKeypressEvents(this.stream),this.stream.on("keypress",this.onKeyPress),this.renderer)this.renderer.render(this.selectedValue);this.stream.setRawMode(!0),this.stream.resume()}close(z=!1){if(this.stream.setRawMode(!1),this.stream.pause(),this.renderer)this.renderer.cleanup();if(z)this.onSelectListener(null);else this.onSelectListener(this.selectedValue,this.values[this.selectedValue]);this.stream.removeListener("keypress",this.onKeyPress)}render(){if(!this.renderer)return;this.renderer.render(this.selectedValue)}onKeyPress(z,B){if(B){if(B.name==="up"&&this.selectedValue>0)this.selectedValue--,this.render();else if(B.name==="down"&&this.selectedValue+1<this.values.length)this.selectedValue++,this.render();else if(B.name==="return")this.close();else if(B.name==="escape"||B.name==="c"&&B.ctrl)this.close(!0)}}}D.default=R});var M=Z((Rz,U)=>{var Q=Rz,I=process.env.TERM_PROGRAM==="Apple_Terminal";Q.cursorTo=(z,B)=>{if(typeof z!=="number")throw new TypeError("The `x` argument is required");if(typeof B!=="number")return"\x1B["+(z+1)+"G";return"\x1B["+(B+1)+";"+(z+1)+"H"};Q.cursorMove=(z,B)=>{if(typeof z!=="number")throw new TypeError("The `x` argument is required");let L="";if(z<0)L+="\x1B["+-z+"D";else if(z>0)L+="\x1B["+z+"C";if(B<0)L+="\x1B["+-B+"A";else if(B>0)L+="\x1B["+B+"B";return L};Q.cursorUp=(z)=>"\x1B["+(typeof z==="number"?z:1)+"A";Q.cursorDown=(z)=>"\x1B["+(typeof z==="number"?z:1)+"B";Q.cursorForward=(z)=>"\x1B["+(typeof z==="number"?z:1)+"C";Q.cursorBackward=(z)=>"\x1B["+(typeof z==="number"?z:1)+"D";Q.cursorLeft="\x1B[G";Q.cursorSavePosition="\x1B["+(I?"7":"s");Q.cursorRestorePosition="\x1B["+(I?"8":"u");Q.cursorGetPosition="\x1B[6n";Q.cursorNextLine="\x1B[E";Q.cursorPrevLine="\x1B[F";Q.cursorHide="\x1B[?25l";Q.cursorShow="\x1B[?25h";Q.eraseLines=(z)=>{let B="";for(let L=0;L<z;L++)B+=Q.eraseLine+(L<z-1?Q.cursorUp():"");if(z)B+=Q.cursorLeft;return B};Q.eraseEndLine="\x1B[K";Q.eraseStartLine="\x1B[1K";Q.eraseLine="\x1B[2K";Q.eraseDown="\x1B[J";Q.eraseUp="\x1B[1J";Q.eraseScreen="\x1B[2J";Q.scrollUp="\x1B[S";Q.scrollDown="\x1B[T";Q.clearScreen="\x1Bc";Q.clearTerminal=process.platform==="win32"?`${Q.eraseScreen}\x1B[0f`:`${Q.eraseScreen}\x1B[3J\x1B[H`;Q.beep="\x07";Q.link=(z,B)=>{return["\x1B]","8",";",";",B,"\x07",z,"\x1B]","8",";",";","\x07"].join("")};Q.image=(z,B)=>{B=B||{};let L="\x1B]1337;File=inline=1";if(B.width)L+=`;width=${B.width}`;if(B.height)L+=`;height=${B.height}`;if(B.preserveAspectRatio===!1)L+=";preserveAspectRatio=0";return L+":"+z.toString("base64")+"\x07"};Q.iTerm={};Q.iTerm.setCwd=(z)=>"\x1B]50;CurrentDir="+(z||process.cwd())+"\x07"});var g=Z((w)=>{Object.defineProperty(w,"__esModule",{value:!0});w.default=void 0;var Dz=o(S("readline")),H=M();function o(z){return z&&z.__esModule?z:{default:z}}class _{constructor(z,B=process.stdout){this.options=z,this.stream=B,this.values=[],this.initialRender=!0}setValues(z){this.values=z}render(z=0){if(this.initialRender)this.initialRender=!1,this.stream.write(H.cursorHide);else this.stream.write(H.eraseLines(this.values.length));this.values.forEach((B,L)=>{let W=z===L?this.options.selected:this.options.unselected,X=" ".repeat(this.options.indentation),F=this.options.valueRenderer(B,z===L),l=L!==this.values.length-1?`
`:"";this.stream.write(X+W+" "+F+l)})}cleanup(){this.stream.write(H.eraseLines(this.values.length)),this.stream.write(H.cursorShow)}}w.default=_});var h=Z((P)=>{Object.defineProperty(P,"__esModule",{value:!0});P.withPromise=P.withCallback=void 0;var e=(z,B,L)=>{z.open(),z.onSelect((W,X)=>L(B(W,X)))};P.withCallback=e;var zz=(z,B)=>{return new Promise((L,W)=>{z.open(),z.onSelect((X,F)=>{if(X===null)W();else L(B(X,F))})})};P.withPromise=zz});var k=Z((j)=>{Object.defineProperty(j,"__esModule",{value:!0});j.withObjectValues=j.withArrayValues=void 0;var Lz=(z)=>{return{input:z.values,output:(B,L)=>{return{id:B,value:L}}}};j.withArrayValues=Lz;var Qz=(z)=>{let B=z.values;return{input:Object.values(B),output:(L,W)=>{return{id:Object.keys(B)[L],value:W}}}};j.withObjectValues=Qz});var c=Z((G,d)=>{Object.defineProperty(G,"__esModule",{value:!0});G.default=void 0;var Xz=x(N()),Yz=x(g()),y=h(),b=k();function x(z){return z&&z.__esModule?z:{default:z}}function Zz(z){for(var B=1;B<arguments.length;B++){var L=arguments[B]!=null?arguments[B]:{},W=Object.keys(L);if(typeof Object.getOwnPropertySymbols==="function")W=W.concat(Object.getOwnPropertySymbols(L).filter(function(X){return Object.getOwnPropertyDescriptor(L,X).enumerable}));W.forEach(function(X){$z(z,X,L[X])})}return z}function $z(z,B,L){if(B in z)Object.defineProperty(z,B,{value:L,enumerable:!0,configurable:!0,writable:!0});else z[B]=L;return z}var Gz={outputStream:process.stdout,inputStream:process.stdin,values:[],defaultValue:0,selected:"(x)",unselected:"( )",indentation:0,cleanup:!0,valueRenderer:(z)=>z},v=(z,B)=>{z=Zz({},Gz,z);let L=new Yz.default(z,z.outputStream),W=new Xz.default(z.inputStream);W.setDefaultValue(z.defaultValue),W.attachRenderer(L);let X;if(Array.isArray(z.values))X=b.withArrayValues(z);else X=b.withObjectValues(z);if(z.values=X.input,W.setValues(z.values),typeof B==="function")return y.withCallback(W,X.output,B);else return y.withPromise(W,X.output)};G=d.exports=v;Object.defineProperty(G,"__esModule",{value:!0});var Hz=v;G.default=Hz});var E=s(c(),1);import Tz from"fs";import qz from"path";var p=process.argv[2]||process.cwd(),T=qz.join(p,".docker-publish");if(!Tz.existsSync(T)){console.log("Initializing .docker-publish file..."),console.log("Enter the Docker image name (e.g., energyhun24/bandwidth-hero-proxy):");let z=await Bun.stdin.text();if(!z)console.error("Docker image name is required."),process.exit(1);console.log("Enter the initial version (e.g., 1.0.0):");let B=await Bun.stdin.text();if(!B)console.error("Initial version is required."),process.exit(1);let L={dockerImageName:z.trim(),version:B.trim()};await Bun.write(T,JSON.stringify(L,null,"\t")),console.log(".docker-publish file created successfully.")}var q=await Bun.file(T).json(),O=q.dockerImageName,$=q.version,C={Current:$,Patch:A($,"Patch"),Minor:A($,"Minor"),Major:A($,"Major")},Ez=Object.keys(C);console.log("Select the version update type:");var Fz=await E.default({values:Ez,valueRenderer:(z)=>{return`${z} (${C[z]})`},cleanup:!0}),Y=C[Fz.value];console.log(`You selected: ${Y}, current version: ${$}`);console.log("Do you want to build, publish the image and update the version in the .version file?");var Az=await E.default({values:["Yes","No"],valueRenderer:(z)=>{return z},cleanup:!0});console.log("Do you want to push the changes to GIT?");var Cz=await E.default({values:["Yes","No"],valueRenderer:(z)=>{return z},cleanup:!0});if(Az.value==="Yes"){if(q.version=Y,await Bun.write(T,JSON.stringify(q,null,"\t")),console.log(`Version updated to: ${Y}`),await Bun.$`docker build -t ${O}:${Y} -t ${O}:latest ${p}`,await Bun.$`docker push ${O}:${Y}`,await Bun.$`docker push ${O}:latest`,Cz.value==="Yes"&&Y!==$)await Bun.$`git add .docker-publish`,await Bun.$`git commit -m "chore: update version to ${Y}"`,await Bun.$`git push`,await Bun.$`git checkout main`,console.log("Changes pushed to GIT.")}else console.log("Aborted.");function A(z,B){let L=z.split(".").map(Number);switch(B){case"Major":L[0]++,L[1]=0,L[2]=0;break;case"Minor":L[1]++,L[2]=0;break;case"Patch":L[2]++;break;default:throw new Error("Invalid version type")}return L.join(".")}
